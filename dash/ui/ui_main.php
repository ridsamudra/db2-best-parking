<?php include $_SERVER['DOCUMENT_ROOT'].'/dash/init_dash.php';?>
<?php include constant('doc_ui').'/ui_header.php';?>
<?php include constant('doc_ui').'/ui_footer.php';?>


<script type="text/javascript">
var daftar_lokasi;var curId=-1;var dataResp;var curImg=null;var filterId;var pdf1;google.charts.load("current",{packages:["corechart"]});setInterval(function(){refresh_data()},3e5);function refresh_data(){if(curId==-1)return;inp=new Object;inp.token="get_data_home";inp.lokasi=new Array;inp.lokasi.push(curId);send(svr_intf+"/intf_get_data_home.php",inp,save_data)}function body_resize(){show_data()}function save_data(inp){dataResp=inp;if(dataResp.err==0){if(dataResp.lokasi.length){income6=dataResp.lokasi[0].income6;for(let i=0;i<income6.length;i++){let val=income6[i][0];income6[i][0]=get_month_name(val%100)+" "+Math.floor(val/100).toString()}income62=dataResp.lokasi[0].income62;for(let i=0;i<income62.length;i++){let val=income62[i][0];income62[i][0]="Thn. "+val.toString()}}}show_data()}function show_data(){clear_childs("content");if(dataResp.err==1)return;lokasi=dataResp.lokasi;document.getElementById("page-title").innerHTML=lokasi[0].info[0][1];p=add_child("content","page","div");p.className="page page-height";p.style.height="100%";realtime=lokasi[0].realtime;income7=lokasi[0].income7;income6=lokasi[0].income6;income62=lokasi[0].income62;pos=lokasi[0].pos;trx_per_hour=lokasi[0].trx_per_hour;for(let y=0;y<3;y++){line=add_child(p.id,"line-"+p.id+y,"div");line.className="flex item-height";for(let x=0;x<3;x++){clr=get_color_dark(y*3+x);col=add_child(line.id,"col-"+line.id+x,"div");col.className="flex-item item-width";hdr=add_child(col.id,"hdr"+col.id,"div");hdr.className="flex-item-header";con=add_child(col.id,"con"+col.id,"div");con.className="flex-item-content";con.style.backgroundColor=clr;ftr=add_child(col.id,"ftr"+col.id,"div");ftr.className="flex-item-footer";let show=get_checkbox_value(filterId);if(show.length==0)show.push(0);let vis_hdr=Array();vis_hdr.push("Tanggal");for(let i=0;i<show.length;i++){let shown=show[i];if(shown==0)vis_hdr.push("Tarif");if(shown==1)vis_hdr.push("Member");if(shown==2)vis_hdr.push("Manual");if(shown==3)vis_hdr.push("Masalah");if(shown==4)vis_hdr.push("Total")}let vis_clr=Array();for(let i=0;i<show.length;i++){let shown=show[i];if(shown==0)vis_clr.push("#0000FF");if(shown==1)vis_clr.push("#804040");if(shown==2)vis_clr.push("#0080FF");if(shown==3)vis_clr.push("red");if(shown==4)vis_clr.push("green")}if(x==0&&y==0){hdr.innerHTML="Pendapatan Realtime ";con.style.display="flex";con.style.flexDirection="row";con.style.flexWrap="wrap";con.style.justifyContent="space-between";if(realtime.length){let total_income=0;for(let j=0;j<realtime.length;j++){div=add_child(con.id,"div"+con.id+j,"div");div.className="flex-item-content-detail";s1=add_child(div.id,"sp-1"+div.id,"span");s1.innerHTML=realtime[j][0];s1.setAttribute("style","color:white; font-weight:bold; font-size:15px");s2=add_child(div.id,"sp-2"+div.id,"span");s2.setAttribute("style","color:#BFE100; font-weight:bold; font-size:12px");s2.innerHTML="Rp."+realtime[j][2].toLocaleString();total_income+=realtime[j][2]}div=add_child(con.id,"div-total"+con.id,"div");div.className="flex-item-content-detail";div.setAttribute("style","background-color:#007900;");s1=add_child(div.id,"sp-1"+div.id,"span");s1.innerHTML="Total";s1.setAttribute("style","color:white; font-weight:bold; font-size:24px");s2=add_child(div.id,"sp-2"+div.id,"span");s2.setAttribute("style","color:white; font-weight:bold; font-size:12px");s2.innerHTML="Rp."+total_income.toLocaleString();s3=add_child(ftr.id,"sp-3"+ftr.id,"label");s3.innerHTML="Update data terakhir pada jam "+realtime[0][4]}}else if(x==1&&y==0){hdr.innerHTML="Jumlah Transaksi Realtime";con.style.display="flex";con.style.flexDirection="row";con.style.flexWrap="wrap";con.style.justifyContent="space-between";if(realtime.length){let total_income=0;for(let j=0;j<realtime.length;j++){div=add_child(con.id,"div"+con.id+j,"div");div.className="flex-item-content-detail";s1=add_child(div.id,"sp-1"+div.id,"span");s1.innerHTML=realtime[j][0];s1.setAttribute("style","color:white; font-weight:bold; font-size:15px");s2=add_child(div.id,"sp-2"+div.id,"span");s2.setAttribute("style","color:#BFE100; font-weight:bold; font-size:12px");s2.innerHTML=realtime[j][1].toLocaleString();total_income+=realtime[j][1];s2.className="font-xl bold"}div=add_child(con.id,"div-total-qty"+con.id,"div");div.className="flex-item-content-detail";div.setAttribute("style","background-color:#007900;");s1=add_child(div.id,"sp-1"+div.id,"span");s1.innerHTML="Total";s1.setAttribute("style","color:white; font-weight:bold; font-size:24px");s2=add_child(div.id,"sp-2"+div.id,"span");s2.setAttribute("style","color:white; font-weight:bold; font-size:12px");s2.innerHTML=total_income.toLocaleString()+" trx"}}else if(x==2&&y==0){let total_income=0;let itemTitle="Persentasi Pendapatan Realtime";hdr.innerHTML=itemTitle;if(realtime.length){data=new Array;let maxVal=0;data.push(["Kendaraan","Pendapatan"]);for(let j=0;j<realtime.length;j++){item=new Array;item.push(realtime[j][0]);item.push(realtime[j][2]);data.push(item);if(maxVal<realtime[j][2])maxVal=realtime[j][2]}options={is3D:true,backgroundColor:clr};pdf1=con;chart=new google.visualization.PieChart(con);chart.draw(google.visualization.arrayToDataTable(data),options)}}else if(x==0&&y==1){let itemTitle="Pendapatan 7 Hari Terakhir";hdr.innerHTML=itemTitle;if(income7.length){arrays=Array();arrays.push(vis_hdr);for(let j=0;j<income7.length;j++){let row=Array();row.push(income7[j][0]);for(let k=0;k<show.length;k++){let shown=show[k];row.push(income7[j][shown+1])}arrays.push(row)}tab=google.visualization.arrayToDataTable(arrays);options={legend:{position:"top",maxLines:3},width:con.offsetWidth,height:con.offsetHeight,backgroundColor:clr,colors:vis_clr};chart=new google.visualization.ColumnChart(con);chart.draw(tab,options)}}else if(x==1&&y==1){let itemTitle="Pendapatan 6 Bulan Terakhir";hdr.innerHTML=itemTitle;if(income6.length){arrays=Array();arrays.push(vis_hdr);for(let j=0;j<income6.length;j++){let row=Array();row.push(income6[j][0]);for(let k=0;k<show.length;k++){let shown=show[k];row.push(income6[j][shown+1])}arrays.push(row)}tab=google.visualization.arrayToDataTable(arrays);options={legend:{position:"top",maxLines:3},width:con.offsetWidth,height:con.offsetHeight,backgroundColor:clr,colors:vis_clr};chart=new google.visualization.ColumnChart(con);chart.draw(tab,options)}}else if(x==2&&y==1){let itemTitle="Pendapatan 6 Tahun Terakhir";hdr.innerHTML=itemTitle;if(income62.length){arrays=Array();arrays.push(vis_hdr);for(let j=0;j<income62.length;j++){let row=Array();row.push(income62[j][0]);for(let k=0;k<show.length;k++){let shown=show[k];row.push(income62[j][shown+1])}arrays.push(row)}tab=google.visualization.arrayToDataTable(arrays);options={legend:{position:"top",maxLines:3},width:con.offsetWidth,height:con.offsetHeight,backgroundColor:clr,colors:vis_clr};chart=new google.visualization.ColumnChart(con);chart.draw(tab,options)}}else if(x==0&&y==2){hdr.innerHTML="Status POS";con.style.display="flex";con.style.flexDirection="row";con.style.flexWrap="wrap";con.style.justifyContent="space-between";if(pos.length){for(let j=0;j<pos.length;j++){div=add_child(con.id,"div"+con.id+j,"div");div.className="flex-item-content-detail";s1=add_child(div.id,"sp-1"+div.id,"span");s1.innerHTML=pos[j][0];s1.setAttribute("style","color:white; font-weight:bold; font-size:15px");s2=add_child(div.id,"sp-2"+div.id,"span");s2.setAttribute("style","color:white; font-weight:bold; font-size:15px");if(pos[j][1]==1){s2.innerHTML="Online";div.style.backgroundColor="#008000"}else{s2.innerHTML="Offline";div.style.backgroundColor="red"}s3=add_child(div.id,"sp-3"+div.id,"span");s3.setAttribute("style","color:white; font-weight:bold; font-size:15px");s3.innerHTML=pos[j][2]+" trx"}}}else if(x==1&&y==2){hdr.innerHTML="Trafic Per Jam";if(trx_per_hour.length){con.setAttribute("style","display:flex;flex-direction:column;");con1=add_child(con.id,"con-1"+con.id,"div");con1.style.flex=1;con2=add_child(con.id,"con-2"+con.id,"div");con2.style.flex=1;arrays=Array();arr=["Jam","Qty Transaksi"];arrays.push(arr);for(let j=0;j<24;j++){r=Array();r.push(j);r.push(trx_per_hour[0][j+1]);arrays.push(r)}tab=google.visualization.arrayToDataTable(arrays);options={legend:{position:"top",maxLines:3},width:con1.offsetWidth,height:con1.offsetHeight,backgroundColor:clr,colors:["#0080FF"]};chart=new google.visualization.ColumnChart(con1);chart.draw(tab,options);arrays=Array();arr=["Jam","Pendapatan"];arrays.push(arr);for(let j=0;j<24;j++){r=Array();r.push(j);r.push(trx_per_hour[0][j+25]);arrays.push(r)}tab=google.visualization.arrayToDataTable(arrays);options={legend:{position:"top",maxLines:3},width:con2.offsetWidth,height:con2.offsetHeight,backgroundColor:clr,colors:["#008080"]};chart=new google.visualization.ColumnChart(con2);chart.draw(tab,options)}}else if(x==2&&y==2){hdr.innerHTML="Foto"}}}}function on_load_event(){document.getElementById("page-title").innerHTML="Dashboard";filter_series=create_form("modal-container","form-series");filter_series.form.style.width="300px";filter_series.caption.innerHTML="Pilih Data Grafik";filter_series.icon.className="icon-filter form-icon";filter_series.btn_ok.onclick=function(){close_modal();show_data()};fill_checkbox(filter_series.content.id,[0,1,2,3,4],["Tarif","Member","Manual","Masalah","Total"],[1,1,1,1,1]);filterId=filter_series.content.id;div=add_child("float-buttons","btn-pdf","div");div=document.getElementById("float-buttons");btn=add_child(div.id,"filter-btn","button");span=add_child(btn.id,"filter-span","span");span.className="icon-filter";btn.onclick=function(){filter_series.modal.style.display="block"};div=add_child("nav-bar","btn-lokasi","div");inp=new Object;inp.token="get_user_location";send(svr_intf+"/intf_get_user_location.php",inp,function(inp1){if(inp1.err==0){let count=inp1.lokasi_user[0].length;for(let i=0;i<count;i++){btn=add_child(div.id,"btn-"+i+"-"+div.id,"button");btn.className="nav-btn";btn.innerHTML=inp1.lokasi_user[1][i];btn.setAttribute("onclick","curId = "+inp1.lokasi_user[0][i]+"; refresh_data();")}if(count!=0)curId=inp1.lokasi_user[0][0];refresh_data()}})}
</script>