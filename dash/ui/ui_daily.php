<?php 
include $_SERVER['DOCUMENT_ROOT'].'/dash/init_dash.php';
if(!is_logged())
	header('Location: '.constant('svr_ui').'/ui_main.php');
else	
    {
    include constant('doc_ui').'/ui_header.php';
    include constant('doc_ui').'/ui_footer.php';
    }
?>

<script>
var daftar_lokasi;var data_pdf=new Array;var curId=-1;var pageTitle;var curTab=null;var filterId;google.charts.load("current",{packages:["table"]});google.charts.load("current",{packages:["corechart"]});function refresh_data(){if(curId==-1)return;inp=new Object;inp.lokasi=new Array;inp.lokasi.push(curId);inp.token="get_data_daily";inp.bulan=get_month_num(get_combobox_value("i-bulan"));inp.tahun=get_combobox_value("i-tahun");send(svr_intf+"/intf_get_data_daily.php",inp,save_data)}function body_resize(){show_data()}function save_data(inp){dataResp=inp;show_data()}function show_data(){clear_childs("content");if(dataResp.err==1)return;let lokasi=dataResp.lokasi[0];pageTitle="Pendapatan Harian "+lokasi.info[0][1]+" "+get_combobox_value("i-bulan")+" "+get_combobox_value("i-tahun");document.getElementById("page-title").innerHTML=pageTitle;let income=lokasi.income;p=add_child("content","page","div");p.className="page";p.setAttribute("style","padding:10px; max-width:1200px;margin:auto;");if(income.row_count){d=add_child(p.id,"table"+p.id,"div");curTab=create_table(d.id,income,"table_click","",true);d=add_child(p.id,"chart"+p.id,"div");d.setAttribute("style","border:1px solid blue;");let show=get_checkbox_value(filterId);if(show.length==0)show.push(0);arrays=Array();let r=Array();r.push("Tanggal");for(let i=0;i<show.length;i++){let shown=show[i];if(shown==0)r.push("Tarif");if(shown==1)r.push("Member");if(shown==2)r.push("Manual");if(shown==3)r.push("Masalah");if(shown==4)r.push("Total")}arrays.push(r);for(let i=0;i<income.rows.length;i++){let r=Array();r.push(income.rows[i][0].toString());for(let j=0;j<show.length;j++){let shown=show[j];if(shown==0)r.push(income.rows[i][1]+income.rows[i][2]);if(shown==1)r.push(income.rows[i][3]);if(shown==2)r.push(income.rows[i][4]);if(shown==3)r.push(income.rows[i][5]);if(shown==4)r.push(income.rows[i][6])}arrays.push(r)}r=Array();for(let i=0;i<show.length;i++){let shown=show[i];if(shown==0)r.push("#0000FF");if(shown==1)r.push("#804040");if(shown==2)r.push("#0080FF");if(shown==3)r.push("red");if(shown==4)r.push("green")}tab=google.visualization.arrayToDataTable(arrays);options={legend:{position:"top",maxLines:3},title:pageTitle,dataOpacity:1,fontName:"Calibri",pointSize:3,colors:r,width:"100%",height:500,vAxis:{gridlines:{color:"#DDDDDD"}}};chart=new google.visualization.LineChart(d);chart.draw(tab,options)}else{s=add_child(p.id,"sp"+p.id,"span");s.innerHTML="Data tidak tersedia !";s.style.color="red"}}function on_load_event(){document.getElementById("page-title").innerHTML="Pendapatan Harian";filter_tanggal=create_form("modal-container","form-tanggal");filter_tanggal.form.style.width="300px";filter_tanggal.caption.innerHTML="Pilih Bulan";filter_tanggal.icon.className="icon-calendar form-icon";filter_tanggal.btn_ok.onclick=function(){close_modal();refresh_data()};filter_series=create_form("modal-container","form-series");filter_series.form.style.width="300px";filter_series.caption.innerHTML="Pilih Data Grafik";filter_series.icon.className="icon-filter form-icon";filter_series.btn_ok.onclick=function(){close_modal();show_data()};fill_checkbox(filter_series.content.id,[0,1,2,3,4],["Tarif","Member","Manual","Masalah","Total"],[1,1,1,1,1]);filterId=filter_series.content.id;const date=new Date;add_child(filter_tanggal.content.id,"","span").innerHTML="Bulan";c=add_child(filter_tanggal.content.id,"i-bulan","select");c.style.width="100%";bln=new Array;for(i=0;i<12;i++)bln.push(month[i]);fill_combobox("i-bulan",bln);c.value=month[date.getMonth()];add_child(filter_tanggal.content.id,"","span").innerHTML="Tahun";c=add_child(filter_tanggal.content.id,"i-tahun","select");c.style.width="100%";thn=new Array;for(i=0;i<20;i++)thn.push(2020+i);fill_combobox("i-tahun",thn);c.value=date.getFullYear();div=document.getElementById("float-buttons");btn=add_child(div.id,"tanggal-btn","button");span=add_child(btn.id,"tanggal-span","span");span.className="icon-calendar";btn.onclick=function(){filter_tanggal.modal.style.display="block"};div=document.getElementById("float-buttons");btn=add_child(div.id,"filter-btn","button");span=add_child(btn.id,"filter-span","span");span.className="icon-filter";btn.onclick=function(){filter_series.modal.style.display="block"};btn=add_child(div.id,"pdf-btn","button");span=add_child(btn.id,"pdf-span","span");span.className="icon-file-pdf";btn.onclick=function(){message("Export","Export ke file PDF ?",msg_ask,function(){close_modal()})};btn=add_child(div.id,"excel-btn","button");span=add_child(btn.id,"excel-span","span");span.className="icon-file-excel";btn.onclick=function(){message("Export","Export ke file Excel ?",msg_ask,function(){close_modal();if(curTab!=null)export_to_excel(curTab,pageTitle)})};div=add_child("nav-bar","btn-lokasi","div");inp=new Object;inp.token="get_user_location";send(svr_intf+"/intf_get_user_location.php",inp,function(inp1){if(inp1.err==0){let count=inp1.lokasi_user[0].length;for(let i=0;i<count;i++){btn=add_child(div.id,"btn-"+i+"-"+div.id,"button");btn.className="nav-btn";btn.innerHTML=inp1.lokasi_user[1][i];btn.setAttribute("onclick","curId = "+inp1.lokasi_user[0][i]+"; refresh_data();")}if(count!=0)curId=inp1.lokasi_user[0][0];refresh_data()}})}
</script>